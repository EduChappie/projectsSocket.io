<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.0/socket.io.js" integrity="sha512-rwu37NnL8piEGiFhe2c5j4GahN+gFsIn9k/0hkRY44iz0pc81tBNaUN56qF8X4fy+5pgAAgYi2C9FXdetne5sQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    
    <div class="cotn">
        <header>
            <h1>ChatTalküéôÔ∏è</h1>
            <hr>
        </header>
        <article class="msgArea">
            <div id="mensagens">
            </div>
        </article>
        <article class="inputArea">
            <section>
                <input type="text" class="inpu" id="user" placeholder="User">
                <textarea id="msg" class="inpu" cols="50" rows="10" placeholder="mensagem..."></textarea>
                <button class="btn" onclick="enviar()">Enviar</button>
            </section>
        </article>
    </div>

    <script>
        const socket = io('http://192.168.10.108:4041');

        //Fun√ß√£o de criar a caixa da mensagem
        function createBox(msg) {
            const screen = document.querySelector('#mensagens');
            screen.innerHTML += `<div class="lineText"><strong classs="authorName">${msg.autor}</strong>: ${msg.texto}</div>`
        } 

        // Ouvindo chamada do servidor, para restaurar mensagens salvas
        socket.on("restaurar", db => {
            for (db of db) {
                createBox(db)
            }
        })

        socket.on("recebimento", msg => {
            createBox(msg);
        })

        // Fun√ß√£o de mandar msg escrita
        function enviar() {
            const msgObject = {
                autor: document.getElementById("user").value,
                texto: document.getElementById("msg").value
            }
            createBox(msgObject)

            socket.emit("newMessage", msgObject);
        }

    </script>
</body>
</html>